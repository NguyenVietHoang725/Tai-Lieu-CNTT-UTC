package com.battleship.view.main;

import com.battleship.view.frames.MainFrame;
import javax.swing.*;
import java.awt.*;

public class GameLauncher {
    // Constants
    private static final String GAME_TITLE = "Battle Ship Game";
    private static final String ERROR_TITLE = "Launch Error";
    
    public static void main(String[] args) {
        // Print system information for debugging
        printSystemInfo();
        
        // Launch the application in the Event Dispatch Thread
        SwingUtilities.invokeLater(() -> {
            try {
                setupLookAndFeel();
                launchGame();
            } catch (Exception e) {
                handleLaunchError(e);
            }
        });
    }
    
    private static void printSystemInfo() {
        System.out.println("System Information:");
        System.out.println("OS: " + System.getProperty("os.name") + " " + System.getProperty("os.version"));
        System.out.println("Java Version: " + System.getProperty("java.version"));
        System.out.println("Screen Resolution: " + getScreenResolution());
        System.out.println("Available Memory: " + getAvailableMemory() + " MB");
        System.out.println("Working Directory: " + System.getProperty("user.dir"));
    }
    
    private static String getScreenResolution() {
        GraphicsDevice gd = GraphicsEnvironment.getLocalGraphicsEnvironment().getDefaultScreenDevice();
        int width = gd.getDisplayMode().getWidth();
        int height = gd.getDisplayMode().getHeight();
        return width + "x" + height;
    }
    
    private static long getAvailableMemory() {
        return Runtime.getRuntime().maxMemory() / (1024 * 1024);
    }
    
    private static void setupLookAndFeel() {
        try {
            // Try to set system look and feel
            UIManager.setLookAndFeel(UIManager.getSystemLookAndFeelClassName());
            
            // Enable anti-aliasing for text
            System.setProperty("awt.useSystemAAFontSettings", "on");
            System.setProperty("swing.aatext", "true");
            
            // Set default font rendering settings
            setDefaultFontSettings();
            
        } catch (Exception e) {
            System.err.println("Could not set system look and feel: " + e.getMessage());
            // Fallback to cross-platform look and feel
            try {
                UIManager.setLookAndFeel(UIManager.getCrossPlatformLookAndFeelClassName());
            } catch (Exception ex) {
                // If even the fallback fails, just continue with default
                System.err.println("Could not set cross-platform look and feel: " + ex.getMessage());
            }
        }
    }
    
    private static void setDefaultFontSettings() {
        // Improve font rendering
        System.setProperty("awt.useSystemAAFontSettings", "on");
        System.setProperty("swing.aatext", "true");
        
        // Set default font
        Font defaultFont = new Font("Arial", Font.PLAIN, 12);
        UIManager.put("Button.font", defaultFont);
        UIManager.put("Label.font", defaultFont);
        UIManager.put("Menu.font", defaultFont);
        UIManager.put("MenuItem.font", defaultFont);
        UIManager.put("TextField.font", defaultFont);
        UIManager.put("TextArea.font", defaultFont);
    }
    
    private static void launchGame() {
        try {
            // Create and configure main frame
            MainFrame mainFrame = new MainFrame();
            
            // Add window listener for proper cleanup
            mainFrame.addWindowListener(new java.awt.event.WindowAdapter() {
                @Override
                public void windowClosing(java.awt.event.WindowEvent windowEvent) {
                    cleanupAndExit();
                }
            });
            
            // Display the frame
            mainFrame.pack();
            mainFrame.setVisible(true);
            
            // Log successful launch
            System.out.println("\nGame launched successfully!");
            System.out.println("Window size: " + mainFrame.getSize().width + "x" + mainFrame.getSize().height);
            
        } catch (Exception e) {
            handleLaunchError(e);
        }
    }
    
    private static void handleLaunchError(Exception e) {
        // Log the error
        System.err.println("Error launching game: " + e.getMessage());
        e.printStackTrace();
        
        // Show error dialog to user
        showErrorDialog(e.getMessage());
        
        // Cleanup and exit
        cleanupAndExit();
    }
    
    private static void showErrorDialog(String errorMessage) {
        SwingUtilities.invokeLater(() -> {
            JOptionPane.showMessageDialog(
                null,
                "Error launching game: " + errorMessage + "\n\nPlease check the logs for more details.",
                ERROR_TITLE,
                JOptionPane.ERROR_MESSAGE
            );
        });
    }
    
    private static void cleanupAndExit() {
        // Perform any necessary cleanup here
        System.out.println("Cleaning up resources...");
        
        // Exit the application
        System.exit(0);
    }
}