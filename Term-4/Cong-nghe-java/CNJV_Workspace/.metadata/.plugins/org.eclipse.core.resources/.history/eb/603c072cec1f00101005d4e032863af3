package battleship.controller;

import battleship.model.GameModel;
import battleship.view.GameView;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import javax.swing.JButton;

public class GameController {
    private GameModel model;
    private GameView view;
    
    public GameController(GameModel model, GameView view) {
        this.model = model;
        this.view = view;
        this.view.setModel(model);
        setupListeners();
    }
    
    private void setupListeners() {
        // Get computer board cells
        Component[] computerCells = ((JPanel)view.getComputerBoardPanel().getComponent(0)).getComponents();
        
        // Add action listeners to computer board cells
        for (int i = 0; i < computerCells.length; i++) {
            final int row = i / 10;
            final int col = i % 10;
            JButton cell = (JButton)computerCells[i];
            
            cell.addActionListener(new ActionListener() {
                @Override
                public void actionPerformed(ActionEvent e) {
                    if (model.isPlayerTurn()) {
                        handlePlayerMove(row, col);
                    }
                }
            });
        }
    }
    
    private void handlePlayerMove(int row, int col) {
        if (model.makeMove(row, col)) {
            view.updateBoards();
            
            if (model.isGameOver()) {
                view.setStatus("Game Over! You won!");
            } else {
                // Computer's turn
                makeComputerMove();
            }
        }
    }
    
    private void makeComputerMove() {
        // Simple AI: Random move
        int row, col;
        do {
            row = (int)(Math.random() * 10);
            col = (int)(Math.random() * 10);
        } while (!model.makeMove(row, col));
        
        view.updateBoards();
        
        if (model.isGameOver()) {
            view.setStatus("Game Over! Computer won!");
        } else {
            view.setStatus("Your turn!");
        }
    }
    
    public void startGame() {
        // Load ships from file
        model.loadShipsFromFile("ships.txt");
        view.setVisible(true);
    }
} 