package com.battleship.core.model.ship;

import java.util.ArrayList;
import java.util.List;

import com.battleship.core.model.Position;
import com.battleship.core.model.board.Node;
import com.battleship.core.model.board.NodeState;
import com.battleship.core.model.state.ShipState;

public class Ship implements IShip {
	private final int length;
	private boolean isHorizontal;
	private final List<Node> nodes;
	private int hitCount;
	private Position position;

	public Ship(int length) {
		this.length = length;
		this.nodes = new ArrayList<>();
		this.hitCount = 0;
		this.isHorizontal = true;
	}

	@Override
	public int getLength() {
		return length;
	}

	@Override
	public boolean isHorizontal() {
		return isHorizontal;
	}

	@Override
	public void setHorizontal(boolean horizontal) {
		this.isHorizontal = horizontal;
	}

	@Override
	public List<Node> getNodes() {
		return nodes;
	}

	@Override
	public boolean isSunk() {
		return hitCount == length;
	}

	@Override
	public void hit() {
		hitCount++;
	}

	@Override
	public Position getPosition() {
		return position;
	}

	@Override
	public void setPosition(Position position) {
		this.position = position;
	}
	
	public boolean isHitAt(Position position) {
        return nodes.stream()
            .anyMatch(node -> node.getX() == position.getX() && 
                            node.getY() == position.getY() && 
                            node.getState() == NodeState.HIT);
    }
    
    // Thêm phương thức để lấy trạng thái tàu
    public ShipState getShipState() {
        return new ShipState(length, isHorizontal, position, isSunk());
    }
}