package com.battleship.core.model;

import com.battleship.core.model.interfaces.IBoard;

public class Board implements IBoard {
    private final Node[][] nodes;
    private final List<Ship> ships;
    private final int size;
    
    public Board() {
        this.size = 10;
        this.nodes = new Node[size][size];
        this.ships = new ArrayList<>();
        initializeBoard();
    }
    
    private void initializeBoard() {
        for (int i = 0; i < size; i++) {
            for (int j = 0; j < size; j++) {
                nodes[i][j] = new Node(i, j);
            }
        }
    }
    
    @Override
    public Node getNode(int x, int y) {
        if (!isValidPosition(x, y)) {
            throw new IllegalArgumentException("Invalid position");
        }
        return nodes[x][y];
    }
    
    @Override
    public boolean isValidPosition(int x, int y) {
        return x >= 0 && x < size && y >= 0 && y < size;
    }
    
    @Override
    public void placeShip(Ship ship, Position position) {
        if (!isValidPosition(position.getX(), position.getY())) {
            throw new IllegalArgumentException("Invalid position");
        }
        
        // Check if ship can be placed
        if (!canPlaceShip(ship, position)) {
            throw new IllegalStateException("Cannot place ship at this position");
        }
        
        // Place ship
        ship.setPosition(position);
        for (int i = 0; i < ship.getLength(); i++) {
            int x = position.getX() + (ship.isHorizontal() ? i : 0);
            int y = position.getY() + (ship.isHorizontal() ? 0 : i);
            Node node = getNode(x, y);
            node.setShip(ship);
            node.setState(NodeState.SHIP);
            ship.getNodes().add(node);
        }
        
        ships.add(ship);
    }
    
    private boolean canPlaceShip(Ship ship, Position position) {
        // Implementation of ship placement validation
        // Check boundaries and adjacent cells
        return true; // Placeholder
    }
    
    // Other IBoard implementations
}