package com.battleship.core.service.impl;

import com.battleship.core.model.attack.AttackResult;
import com.battleship.core.model.board.Board;
import com.battleship.core.model.board.IBoard;
import com.battleship.core.model.board.Node;
import com.battleship.core.model.board.Position;
import com.battleship.core.model.ship.Ship;
import com.battleship.core.model.state.BoardState;
import com.battleship.core.service.interfaces.IBoardService;

public class BoardServiceImpl implements IBoardService {

	@Override
	public IBoard createBoard() {
		return new Board();
	}

	@Override
	public boolean placeShip(IBoard board, Ship ship, Position position) {
		try {
            board.placeShip(ship, position);
            return true;
        } catch (IllegalArgumentException | IllegalStateException e) {
            return false;
        }
	}

	@Override
	public AttackResult handleAttack(IBoard board, Position position) {
		if (!board.isPositionValidForAttack(position)) {
            return new AttackResult(false, false, null);
        }
        
        Node node = board.getNode(position.getX(), position.getY());
        if (node.hasShip()) {
            node.hit();
            Ship hitShip = node.getShip();
            return new AttackResult(true, hitShip.isSunk(), hitShip);
        } else {
            node.miss();
            return new AttackResult(false, false, null);
        }
	}

	@Override
	public boolean isValidPosition(IBoard board, Position position) {
		return board.isValidPosition(position.getX(), position.getY());
	}

	@Override
	public boolean canPlaceShip(IBoard board, Ship ship, Position position) {
		if (board instanceof Board) {
            return ((Board) board).canPlaceShipAt(ship, position);
        }
        return false;
	}

	@Override
	public BoardState getBoardState(IBoard board) {
		if (board instanceof Board) {
            return ((Board) board).getBoardState();
        }
        return null;
	}

	@Override
	public void clearBoard(IBoard board) {
		if (board instanceof Board) {
            ((Board) board).clear();
        }
	}

}
