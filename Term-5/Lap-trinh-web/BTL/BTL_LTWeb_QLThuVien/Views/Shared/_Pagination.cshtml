@*
    Đây là Partial View (_Pagination.cshtml) dùng để hiển thị thanh phân trang
    cho Model dạng PagedList.Core.IPagedList<T>.
*@
@model PagedList.Core.IPagedList

<div class="d-flex justify-content-between align-items-center mt-3">
    <nav aria-label="Page navigation">
        <ul class="pagination mb-0">
            @{
                // Lấy Action hiện tại
                var currentAction = ViewContext.RouteData.Values["action"].ToString();

                // === LẤY CÁC THAM SỐ LỌC HIỆN TẠI TỪ VIEWBAG ===
                string searchString = ViewBag.CurrentFilter as string;
                string maQg = ViewBag.CurrentMaQg as string; // <<< THAM SỐ LỌC ĐƯỢC DUY TRÌ
                                                             // =================================================

                // Hàm Helper để tạo Route Data với các tham số lọc được giữ lại
                Func<int, object> createRouteValues = (pageNumber) => new
                {
                    page = pageNumber,
                    searchString = searchString,
                    maQg = maQg // <<< ĐÃ THÊM MA QG VÀO ROUTE
                };
            }

            @* Nút Previous *@
            <li class="page-item @(Model.IsFirstPage ? "disabled" : "")">
                <a class="page-link"
                             href="@(Model.IsFirstPage ? "#" : Url.Action(currentAction, createRouteValues(Model.PageNumber - 1)))"
                             aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>

            @* Các trang số *@
            @for (int i = 1; i <= Model.PageCount; i++)
            {
                <li class="page-item @(i == Model.PageNumber ? "active" : "")">
                    <a class="page-link"
                                   href="@Url.Action(currentAction, createRouteValues(i))">
                        @i
                    </a>
                </li>
            }

            @* Nút Next *@
            <li class="page-item @(Model.IsLastPage ? "disabled" : "")">
                <a class="page-link"
                             href="@(Model.IsLastPage ? "#" : Url.Action(currentAction, createRouteValues(Model.PageNumber + 1)))"
                             aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
        </ul>
    </nav>

    @* Hiển thị thông tin trang (Tùy chọn) *@
    <div class="text-muted d-none d-sm-block">
        Trang @Model.PageNumber / @Model.PageCount
        (@Model.TotalItemCount mục)
    </div>
</div>